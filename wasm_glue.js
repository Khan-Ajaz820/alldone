!function(){let t="undefined"!=typeof window?window:self,e=null,o=null;async function l(l="build/full_mosaic.wasm"){let n=await fetch(l);if(!n.ok)throw Error("Failed to fetch wasm: "+n.statusText);let a=await n.arrayBuffer(),r={env:{abort(t,e,o,l){console.error("abort called at index.ts:"+o+":"+l)},seed:Date.now}},{instance:i}=await WebAssembly.instantiate(a,r);return e=i,o=i.exports,t.wasmReady=!0,o}async function n(e="kd_tree.json"){if(!o)throw Error("WASM not loaded");let l=await fetch(e);if(!l.ok)throw Error("Failed to fetch kd_tree.json: "+l.statusText);let n=await l.json(),a=[],r=new Map;t.emojiSrcs=[];let i=function e(o){if(!o)return -1;let l=o.left?e(o.left):-1,n=o.right?e(o.right):-1,i=-1;if(o.point&&o.point.src){let s=o.point.src;r.has(s)?i=r.get(s):(i=t.emojiSrcs.length,t.emojiSrcs.push(s),r.set(s,i))}let $=o.point&&o.point.avg?o.point.avg:[0,0,0],u="number"==typeof o.axis?o.axis:0,f=a.length;return a.push({avg:$,left:l,right:n,axis:u,srcIndex:i}),f}(n);o.initNodeCount(0|a.length);for(let s=0;s<a.length;s++){let $=a[s];o.setNodeAt(0|s,$.avg[0]||0,$.avg[1]||0,$.avg[2]||0,0|$.left,0|$.right,0|$.axis,0|$.srcIndex)}return o.setRootIndex(0|i),{nodesCount:a.length,rootIndex:i,emojiSrcs:t.emojiSrcs}}t.emojiSrcs=[],t.wasmReady=!1,t.loadWasmModule=l,t.loadKDTreeIntoWasm=n,t.calculateTileColorsFromCanvas=function t(e,o=16){let l=e.getContext("2d"),n=e.width,a=e.height,r=Math.floor(n/o),i=Math.floor(a/o),s=[];for(let $=0;$<i;$++)for(let u=0;u<r;u++){let f=u*o,d=$*o,c=l.getImageData(f,d,o,o),h=c.data,g=0,m=0,w=0,p=0;for(let x=0;x<h.length;x+=4){let j=h[x+3];0!==j&&(g+=h[x],m+=h[x+1],w+=h[x+2],p++)}0===p?s.push([0,0,0]):s.push([g/p,m/p,w/p])}return{colors:s,cols:r,rows:i}},t.runMatchingAndGetResults=function e(l){if(!o)throw Error("WASM not loaded");let n=0|l.length;o.initTileCount(n);for(let a=0;a<n;a++){let r=l[a];o.setTileColorAt(0|a,r[0],r[1],r[2])}o.processAll();let i=Array(n);for(let s=0;s<n;s++){let $=o.getResultAt(0|s);i[s]=$>=0&&$<t.emojiSrcs.length?t.emojiSrcs[$]:null}return i}}();